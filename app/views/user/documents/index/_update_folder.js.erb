function move_folder(id) {

    var doc = $('input[name="doc_name[]"]:checked').map(function () {
        return this.value;
    }).get();

    data_send = {folder_id: id}
    $('input[name="doc_name[]"]:checked').each(function () {

        $.ajax({
            method: 'put',
            url: this.value,
            data: data_send,
            headers: {
                'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
            },
            success: function (data) {
                location.reload();

            }
        });
    });
}
function drag(ev, ur) {

    ev.dataTransfer.setData("folder", ur);
}
function drop(ev, fold) {

    ev.preventDefault();
    var data = ev.dataTransfer.getData("folder");
    data_send = {folder_id: fold}
    $.ajax({
        method: 'put',
        url: data,
        data: data_send,
        headers: {
            'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
        },
        success: function (data) {
            location.reload();

        }
    });


}
function allowDrop(ev) {
    ev.preventDefault();
}
$(function () {
    $('#folder-form').click(function (e) {
        e.preventDefault();
        if ($('#title').val() == '') {
            alert('Folder Title is required');
            return false;
        }
        var user_id = $('#user_id').val();
        var title = $('#title').val();
        data_send = {user_id: user_id, title: title}
        $.ajax({
            url: "/user/document_folder/",
            type: "POST",
            data: data_send,
            dataType: "json",
            headers: {
                'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
            },
            success: function (data) {
                if (data.error) {
                    alert("Given Folder name already taken");
                } else {
                    $('#foldermmodal').modal('hide');
                    parent.$('#tree2 .branch').append('<li id="' + data.id + '"  ondrop=\"drop(event,\'' + data.id + '\')\" ondragover=\"allowDrop(event)\"><i class="fa fa-folder-o"></i><a href="/user/documents?folder_id=' + data.id + '">' + data.title + '</a>'
                            + '<a class=\"edit-folder\"  href=\"#editfoldermmodal\" data-toggle=\"modal\" data-id=\"' + data.id + '\" data-title=\"' + data.title + '\" data-target=\"#editfoldermmodal\"><i class=\"fa fa-edit\"></i></a>'
                            + '<button  onClick=\"delete_folder(' + data.title + ',' + data.id + ')"><span>X</span></button></li>');
                }
            }
        });
    });
});


function delete_folder(title, id) {

    var r = confirm("Do you want to remove " + title + " folder.");
    if (r == true) {
        $("#LOADER").show();

        data_send = {folder_id: id}
        $.ajax({
            method: 'PUT',
            url: "/user/update_document/",
            data: data_send,
            headers: {
                'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
            },
            success: function (data) {

                //$("#LOADER").hide();
                location.reload();

            }

        });
    }
}

$(document).on("click", ".edit-folder", function () {

    var id = $(this).data('id');
    var title = $(this).data('title');
    $(".edit-content #id").val(id);
    $(".edit-content #title").val(title);
    //$(".modal-footer #folder-form").attr( 'id','edit-folder-form' );

});


$(function () {
    $('#edit-folder-form').click(function (e) {
       
        e.preventDefault();
        if ($('.edit-content #title').val() == '') {
            alert('Folder Title is required');
            return false;
        }
        var user_id = $('.edit-content #user_id').val();
        var title = $('.edit-content #title').val();
     
        var id = $('.edit-content #id').val();
        data_send = {id: id, user_id: user_id, title: title}
        $.ajax({
            url: "/user/document_folder/" + id,
            type: "PUT",
            data: data_send,
            dataType: "json",
            headers: {
                'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
            },
            success: function (data) {
                if (data.error) {
                    alert("Given Folder name already taken");
                } else {
                    $('#editfoldermmodal').modal('hide');
                    parent.$("#" + data.id).remove();

                    parent.$('#tree2 .branch').append('<li id="' + data.id + '"  ondrop=\"drop(event,\'' + data.id + '\')\" ondragover=\"allowDrop(event)\"><i class="fa fa-folder-o"></i><a href="/user/documents?folder_id=' + data.id + '">' + data.title + '</a>'
                            + '<a class=\"edit-folder\"  href=\"#editfoldermmodal\" data-toggle=\"modal\" data-id=\"' + data.id + '\" data-title=\"' + data.title + '\" data-target=\"#editfoldermmodal\"><i class=\"fa fa-edit\"></i></a>'
                            + '<button  onClick=\"delete_folder(' + data.title + ',' + data.id + ')"><span>X</span></button></li>'
                            );

                }
            }
        });
    });
});